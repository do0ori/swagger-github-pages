# ğŸ§ GitHub Actions workflow ë¶„ì„í•´ë³´ê¸°

> The template will periodically auto-update the Swagger UI dependency and create a pull request. See the [GitHub Actions workflow here](https://github.com/peter-evans/swagger-github-pages/blob/master/.github/workflows/update-swagger.yml).

ì´ GitHub Actions workflowëŠ” Swagger UIì˜ ìµœì‹  releaseë¥¼ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ê³  ë³€ê²½ ì‚¬í•­ì„ PRë¡œ ìƒì„±í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.

## 1. Trigger ì¡°ê±´

```yaml
on:
  schedule:
    - cron: "0 10 * * *" # ë§¤ì¼ ì˜¤ì „ 10ì‹œì— ì‹¤í–‰
  workflow_dispatch: # ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì˜µì…˜
```

- `schedule`: ë§¤ì¼ ì˜¤ì „ 10:00 UTCì— ì´ workflowê°€ ìë™ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤. ([GitHub Actions schedule ê´€ë ¨ ì°¸ê³  ìë£Œ](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#schedule))
- `workflow_dispatch`: GitHub interfaceë¥¼ í†µí•´ ìˆ˜ë™ìœ¼ë¡œ ì´ workflowë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤. ([GitHub Actions workflow_dispatch ê´€ë ¨ ì°¸ê³  ìë£Œ](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow_dispatch))

## 2. Job ì •ì˜

```yaml
jobs:
  updateSwagger:
    runs-on: ubuntu-latest
```

- jobì˜ ì´ë¦„ì€ `updateSwagger`ì´ê³  ìµœì‹  Ubuntu ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰ëœë‹¤.

## 3. Steps

### 1. ì½”ë“œ checkout

```yaml
steps:
  - uses: actions/checkout@v4
```

- ë¦¬í¬ì§€í† ë¦¬ì˜ ì½”ë“œë¥¼ ì•ì„œ ìƒì„±ëœ Ubuntu ê°€ìƒ ë¨¸ì‹ ì˜ ì‘ì—… ë””ë ‰í† ë¦¬ë¡œ ë³µì‚¬í•œë‹¤.
- ì´ì œ ëª¨ë“  ì½”ë“œ ì‘ì—…ì€ ì—¬ê¸°ì„œ ì´ë£¨ì–´ì§„ë‹¤.

### 2. ìµœì‹  Swagger UI Release ê°€ì ¸ì˜¤ê¸°

```yaml
- name: Get Latest Swagger UI Release
  id: swagger-ui
  run: |
    release_tag=$(curl -sL https://api.github.com/repos/swagger-api/swagger-ui/releases/latest | jq -r ".tag_name")
    echo "release_tag=$release_tag" >> $GITHUB_OUTPUT
    current_tag=$(<swagger-ui.version)
    echo "current_tag=$current_tag" >> $GITHUB_OUTPUT
```

- ìµœì‹  Swagger UI release tagë¥¼ ê°€ì ¸ì™€ `release_tag` ë³€ìˆ˜ì— ì €ì¥í•œë‹¤.
- [swagger-ui.version](swagger-ui.version) íŒŒì¼ì—ì„œ í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ release tagë¥¼ ì½ì–´ `current_tag` ë³€ìˆ˜ì— ì €ì¥í•œë‹¤.

### 3. Swagger UI ì—…ë°ì´íŠ¸

```yaml
- name: Update Swagger UI
  if: steps.swagger-ui.outputs.current_tag != steps.swagger-ui.outputs.release_tag
  env:
    RELEASE_TAG: ${{ steps.swagger-ui.outputs.release_tag }}
    SWAGGER_YAML: "swagger.yaml"
  run: |
    rm -fr dist index.html
    curl -sL -o $RELEASE_TAG https://api.github.com/repos/swagger-api/swagger-ui/tarball/$RELEASE_TAG
    tar -xzf $RELEASE_TAG --strip-components=1 $(tar -tzf $RELEASE_TAG | head -1 | cut -f1 -d"/")/dist
    rm $RELEASE_TAG
    mv dist/index.html .
    sed -i "s|https://petstore.swagger.io/v2/swagger.json|$SWAGGER_YAML|g" dist/swagger-initializer.js
    sed -i "s|href=\"./|href=\"dist/|g" index.html
    sed -i "s|src=\"./|src=\"dist/|g" index.html
    sed -i "s|href=\"index|href=\"dist/index|g" index.html
    echo ${{ steps.swagger-ui.outputs.release_tag }} > swagger-ui.version
```

- ìµœì‹  release tag(`release_tag`)ì™€ í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ tag(`current_tag`)ê°€ ë‹¤ë¥¼ ê²½ìš° ì‹¤í–‰ëœë‹¤.
- [dist](dist) ë””ë ‰í† ë¦¬ì™€ [index.html](index.html) íŒŒì¼ì„ ì‚­ì œí•œë‹¤.
- ìµœì‹  releaseë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ì••ì¶• í•´ì œí•˜ì—¬ dist ë””ë ‰í† ë¦¬ë¥¼ ì¶”ì¶œí•œë‹¤.
- dist/index.htmlì„ root ë””ë ‰í† ë¦¬ë¡œ ì˜®ê¸´ë‹¤.
- dist/swagger-initializer.jsì™€ index.html íŒŒì¼ì˜ ê²½ë¡œì™€ ì°¸ì¡°ë¥¼ ìˆ˜ì •í•œë‹¤.
- ìƒˆë¡œìš´ release tag(`release_tag`)ë¥¼ [swagger-ui.version](swagger-ui.version) íŒŒì¼ì— ì €ì¥í•œë‹¤.

### 4. Pull Request ìƒì„±

```yaml
- name: Create Pull Request
  uses: peter-evans/create-pull-request@v6
  with:
    commit-message: Update swagger-ui to ${{ steps.swagger-ui.outputs.release_tag }}
    title: Update SwaggerUI to ${{ steps.swagger-ui.outputs.release_tag }}
    body: |
      Updates [swagger-ui][1] to ${{ steps.swagger-ui.outputs.release_tag }}

      Auto-generated by [create-pull-request][2]

      [1]: https://github.com/swagger-api/swagger-ui
      [2]: https://github.com/peter-evans/create-pull-request
    labels: dependencies, automated pr
    branch: swagger-ui-updates
```

- peter-evans/create-pull-request actionì„ ì‚¬ìš©í•˜ì—¬ Swagger UIì˜ ìµœì‹  releaseë¡œ ì—…ë°ì´íŠ¸í•˜ëŠ” PRì„ ìƒì„±í•œë‹¤.
- commit message, PR ì œëª©, ë³¸ë¬¸, label ë“±ì„ ì„¤ì •í•œë‹¤.
- swagger-ui-updatesë¼ëŠ” ì´ë¦„ì˜ branchì—ì„œ PRì„ ìƒì„±í•œë‹¤.

![image](https://github.com/do0ori/swagger-github-pages/assets/71831926/b733f86c-f7bc-4e1e-aef8-40b9d5903992)
